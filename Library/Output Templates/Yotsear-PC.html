<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>@NAME</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500&family=Raleway&display=swap" rel="stylesheet">
<style>
    .qty1 {
     /*   visibility: hidden; */
    }
    .title { 
        font-weight: bold;
        text-align: right;
    }
    .field {
        padding-left: 1ex;
        padding-right: 1ex;
        color: darkblue;
    }
    .underlined {
        border-bottom: thin solid black;
    }
    th { 
        text-align: left;
        text-decoration: underline;
        font-weight:bold;
    }
    body {
        width: 8in;
        font-size: 9pt;
        font-family: Verdana, sans-serif;
        padding: 1ex;
        display:grid;
        grid-template-columns:  1fr  1fr  1fr  1fr;
        grid-template-rows: auto;
        gap: 1ex 1ex;
        grid-auto-flow: column;
        grid-template-areas:
            "charinfo charinfo charinfo charinfo"
            "primary-attributes secondary-attributes defense hit-locations"
            "melee melee skills skills"
            "ranged ranged skills skills"
            "languages reactions skills skills"
            "conditional conditional skills skills"
            "carried-equipment carried-equipment traits traits"
            "other-equipment other-equipment lift lift"
            "encumbrance notes notes notes"
            ;
    }
    div {
        box-decoration-break: clone;
        -webkit-box-decoration-break: clone;
    }


    .charinfo {  
        grid-area: charinfo;
        padding: 20px;
        border: thin solid black;
        display: grid;
        grid-template-columns: 1fr 3fr 1fr 3fr 1fr 3fr 1fr 1fr; 
        grid-template-rows: auto;
        gap: 5px 5px;
        grid-auto-flow: column;
        grid-template-areas:
              "char-name-field char-name-field char-name-field char-name-field player player-field player-field player-field"
              "char-title-field char-title-field org-field org-field ancestry ancestry-field total-points total-points-field"
              "height height-field eyes eyes-field hair hair-field unspent-points unspent-points-field "
              "weight weight-field skin skin-field hand hand-field tl tl-field"
              "birthday birthday-field age age-field religion religion-field size size-field";
    }
 
    .char-name-field { grid-area: char-name-field; font-size: 20pt; text-align: center;}
    .player-field { grid-area: player-field;  }
    .player { grid-area: player;}
    .char-title { grid-area: char-title; }
    .char-title-field { grid-area: char-title-field;}
    .org-field {grid-area: org-field; }
    .org {grid-area: org; }
    .ancestry-field { grid-area: ancestry-field; }
    .ancestry { grid-area: ancestry; }
    .total-points-field { grid-area: total-points-field;  font-size:16pt;}
    .total-points { grid-area: total-points; }
    .height { grid-area: height; }
    .height-field { grid-area: height-field;  }
    .weight { grid-area: weight; }
    .weight-field { grid-area: weight-field;  }
    .hair { grid-area: hair; }
    .hair-field { grid-area: hair-field; }
    .unspent-points { grid-area: unspent-points; }
    .unspent-points-field { grid-area: unspent-points-field; height: 100%; font-size:16pt}
    .age-field { grid-area: age-field;  }
    .age { grid-area: age; }
    .birthday-field { grid-area: birthday-field; }
    .birthday { grid-area: birthday; }
    .eyes-field { grid-area: eyes-field; }
    .eyes { grid-area: eyes; }
    .hand-field { grid-area: hand-field; }
    .hand { grid-area: hand; }
    .name { grid-area: name; }
    .size-field { grid-area: size-field;  }
    .size { grid-area: size; }
    .skin-field { grid-area: skin-field; }
    .skin { grid-area: skin; }
    .tl-field{grid-area: tl-field; }
    .tl {grid-area: tl; }
    .religion {grid-area: religion; }
    .religion-field {grid-area: religion-field; }

    .primary-attributes {grid-area: primary-attributes; width:100%; font-size: 110%; border: thin solid black;}
    .primary-attributes .box {font-size: 130%; }
    .box {border: thin solid black; padding: 6pt; text-align:center;}
    .secondary-attributes {grid-area: secondary-attributes; font-size: 110%;  border: thin solid black;}
    .secondary-attributes .box {font-size: 130%; }
    .defense {grid-area: defense; font-size: 110%;  border: thin solid black;}
    .defense .box {font-size: 150%; }
    .melee {grid-area: melee;  border: thin solid black; font-size: 90%;}
    .ranged {grid-area: ranged;  border: thin solid black; font-size: 90%}
    .carried-equipment { grid-area: carried-equipment;  border: thin solid black;}
    .other-equipment { grid-area: other-equipment;  border: thin solid black;}
    .traits {grid-area: traits; min-width: 2.5in; font-size: 90%;  border: thin solid black;}
    .skills {grid-area: skills; min-width: 2.5in; font-size: 90%;   border: thin solid black;}
    .encumbrance {grid-area: encumbrance; font-size: 90%;   border: thin solid black;}
    .lift {grid-area: lift; min-width: 2.5in; font-size: 90%;   border: thin solid black;}
    .points {text-align:center;}
    .equipment { width: 100%; padding: 20px; font-size: 90%;  border: thin solid black;}
    /*.note {font-size: 70%; font-weight:normal; padding-left: 12px; } */
    .reactions { grid-area: reactions; border: thin solid black; }
    .conditional { grid-area: conditional; border: thin solid black; }
    .languages { grid-area: languages; border: thin solid black;}
    .hit-locations { grid-area: hit-locations; border: thin solid black; }
    .hit-locations th {text-align: center;}
    .hit-locations td {text-align: center;}
    .notes {grid-area: notes; border: thin solid black;}
    td { padding: 0.5ex; padding-left: 1ex; padding-right:1ex; vertical-align: top; min-width: 5ex;}
    .number { text-align: right; }
    .table-title {text-decoration: none; background-color: black; color: white; padding: 1ex; font-size: 110%; height: 1.3ex; font-weight: bold; text-align: center; }
    table { width: 100%; font-size: 95%; }
    .alternate tr:nth-child(even) {
        background-color: #D3D3D3;
    }
    #notifications {
        color: red;
    }

/* Tooltip text */
    .note {
        font-size: 90%;
      visibility: hidden;
      width: 150px;
      background-color: black;
      color: white;
      text-align: center;
      padding: 5px;
      border-radius: 6px;
      position: absolute;
      z-index: 1;
      font-weight: bold;
    }

    td:hover .note {
      visibility: visible;
    }
    #vision, #hearing, #taste_smell, #touch, #fright_check {
        display: none;
    }
</style>
</head>
<body>
<div class="charinfo">
  <div class="char-name-field field">@NAME</div>
  <div class="player title">Player</div>
  <div class="player-field field">@PLAYER</div>
  <!-- div class="char-title title">Title</div -->
  <div class="char-title-field field">@TITLE</div>
  <!--div class="org title">Organization</div -->
  <div class="org-field field">@ORGANIZATION</div>
  <div class="ancestry title">Ancestry</div>
  <div class="ancestry-field field underlined">@RACE</div>
  <div class="total-points-field field underlined">@TOTAL_POINTS</div>
  <div class="total-points title">Points</div>
  <div class="height title">Height</div>
  <div class="height-field field underlined">@HEIGHT</div>
  <div class="weight title">Weight</div>
  <div class="weight-field field underlined">@WEIGHT</div>
  <div class="hair title">Hair</div>
  <div class="hair-field field underlined">@HAIR</div>
  <div class="unspent-points title">Unspent</div>
  <div class="unspent-points-field field underlined">@UNSPENT_POINTS</div>
  <div class="eyes title">Eyes</div>
  <div class="eyes-field field underlined">@EYES</div>
  <div class="skin title">Skin</div>
  <div class="skin-field field underlined">@SKIN</div>
  <div class="hand title">Handedness</div>
  <div class="hand-field field underlined">@HAND</div>
  <div class="tl title">TL</div>
  <div class="tl.field field underlined">@TL</div>
  <div class="birthday title">Birthday</div>
  <div class="birthday-field field underlined">@BIRTHDAY</div>
  <div class="age title">Age</div>
  <div class="age-field field underlined">@AGE</div>
  <div class="religion title">Religion</div>
  <div class="religion-field field underlined">@RELIGION</div>
  <div class="size title">Size</div>
  <div class="size-field field underlined">@SIZE</div>
</div>
    <div class="primary-attributes">
    <table>
        <tr><th class="table-title" colspan="4">Attributes</th></tr>
@PRIMARY_ATTRIBUTE_LOOP_START
<tr><td class="title">@NAME</td><td class="box field">@VALUE</td><td></td><td class="points">[@POINTS]</td></tr>
@PRIMARY_ATTRIBUTE_LOOP_END
            <tr><td>&nbsp;</td><td></td><td></td></tr>
            <tr><td class="title">Thrust</td><td class="box field">@THRUST</td><td></td><td></td></tr>
            <tr><td class="title">Swing</td><td class="box field">@SWING</td><td></td><td></td></tr>
        </table>
    </div>
    <script>
                function poolConditionNotifications(){
                    var output = "";
                    var cur_hp = document.getElementById("cur_hp").value;
                    var cur_fp = document.getElementById("cur_fp").value;
                    var cur_cp = document.getElementById("cur_cp").value;

                    if( cur_hp < Math.ceil(hp/3) && cur_hp >= -5*hp){
                        output += "<li>Halve your Move and Dodge (round up).</li>";
                    } 
                    if ( cur_hp <= 0 && cur_hp > -5* hp) {
                        output += "<li>Make a HT roll at the start of each of your turns, at -1 per full multiple of HP below zero or fall unconscious. Each time you pass a negative multiple of HP, immediately make a HT roll or die.</li>";
                    } else if ( cur_hp <= -5*hp && cur_hp > -10* hp) {
                        output += "<li>You're dead.</li>";
                    } else if ( cur_hp <= -10*hp){
                        output += "<li>You're dead and your body is destroyed.";            
                    }
                    if( cur_fp < Math.ceil(fp/3) && cur_fp >= -1*fp){
                        output += "<li>Halve your Move, Dodge, and ST (round up).</li>";
                    } 
                    if ( cur_fp < 0 && cur_fp > -1* fp) {
                        output += "<li>If you suffer further fatigue, each FP you lose also causes 1 HP of injury. To do anything besides talk or rest, you must make a Will roll On a failure, you collapse, incapacitated, and can do nothing until you recover to posi- tive FP. On a critical failure, make an immediate HT roll. If you fail, you suffer a heart attack.</li>";
                    } else if ( cur_fp <= -1*fp ) {
                        output += "<li>You're unconscious.</li>";
                    }
                    if( cur_cp >= Math.ceil(cm*0.1) && cur_cp < Math.ceil(cm/2)){
                        output += "<li>-2 to DX. May only move as an Attack maneuver.</li>";
                    } else if ( cur_cp >= Math.ceil(cm/2) && cur_cp < cm ) {
                        output += "<li>-4 to DX. May only move as an Attack maneuver.</li>";
                    } else if ( cur_cp >= cm && cur_cp < Math.ceil(1.5*cm)) {
                        output += "<li>-6 to DX. May only move as an Attack maneuver.</li>";
                    } else if ( cur_cp >= Math.ceil(1.5*cm) && cur_cp < 2*cm) {
                        output += "<li>-8 to DX. May only move as an Attack maneuver.</li>";
                    } else if ( cur_cp >= 2*cm ) {
                        output += "<li>-12 to DX. May only move as an Attack maneuver.</li>";
                    }
                    document.getElementById("notifications").innerHTML = output;

                    if(output){
                        document.getElementById("notifications").style.display = "block";
                    } else {
                        document.getElementById("notifications").style.display = "none";
                    }
               }
    </script>
    <div class="secondary-attributes">
        <table >
            <tr><th class="table-title" colspan="4">Secondary</th></tr>
@SECONDARY_ATTRIBUTE_LOOP_START
<tr id="@ID"><td class="title">@COMBINED_NAME</td><td class="box field">@VALUE</td><td></td><td class="points">[@POINTS]<script> let @ID = @VALUE; </script></td></tr>
@SECONDARY_ATTRIBUTE_LOOP_END
<!--
            <tr><td class="title">Will</td><td class="box field">@WILL</td><td></td><td class="points">[@WILL_POINTS]</td></tr>
            <tr><td class="title">Per</td><td class="box field">@PERCEPTION</td><td></td><td class="points">[@PERCEPTION_POINTS]</td></tr>
            <tr><td class="title">Basic Speed</td><td class="box field">@BASIC_SPEED</td><td></td><td class="points">[@BASIC_SPEED_POINTS]</td></tr>
            <tr><td class="title">Basic Move</td><td class="box field">@BASIC_MOVE</td><td></td><td class="points">[@BASIC_MOVE_POINTS]</td></tr>
-->
            <tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
@POINT_POOL_LOOP_START
            <tr id="@ID"><td class="title">@COMBINED_NAME</td><td class="box field">@MAXIMUM</td><td class="box field" style="min-width:1em;"><input type="number" id="cur_@ID" name="Current @NAME" min="0" max="@MAXIMUM" size="4"  value="@CURRENT" placeholder="@CURRENT" onchange="poolConditionNotifications()" ></td><td class="points">[@POINTS]<script> let @ID = @MAXIMUM; </script></td></tr>
@POINT_POOL_LOOP_END
            <tr id="@ID"><td class="title">Control Points</td><td></td><td class="box field" style="min-width:1em;"><input type="number" id="cur_cp" name="Current CP" min="0" size="4"  value="0" placeholder="0" onchange="poolConditionNotifications()" ></td><td></td></tr>
<tr><td colspan="4"><ul id="notifications"></ul></td></tr>
            <!--
            <tr><td class="title">Hit Points (HP)</td><td class="box field">@BASIC_HP</td><td class="box field" style="min-width:1em;"><input type="number" id="cur_hp" name="Current HP" min="@DEAD" max="@HP" size="4"  value="@HP" placeholder="@HP" ></td><td class="points">[@HP_POINTS]</td></tr>
            <tr><td class="title">Fatigue Points (FP)</td><td class="box field">@BASIC_FP</td><td class="box field" style="min-width:1em;"><input type="number" max="@FP" min="@UNCONSCIOUS" id="cur_fp" name="Current FP" size="4"  value="@FP" placeholder="@FP"></td><td class="points">[@FP_POINTS]</td></tr>
            -->
        </table>
    </div>
    <div class="lift">
        <table class="alternate">
            <tr><th class="table-title" colspan="2">Lift and Carry</th></tr>
            <tr><td class="title">Basic Lift</td><td class="field">@BASIC_LIFT</td></tr>
            <tr><td class="title">One-Handed Lift</td><td class="field">@ONE_HANDED_LIFT</td></tr>
            <tr><td class="title">Two-Handed Lift</td><td class="field">@TWO_HANDED_LIFT</td></tr>
            <tr><td class="title">Shove</td><td class="field">@SHOVE</td></tr>
            <tr><td class="title">Running Shove</td><td class="field">@RUNNING_SHOVE</td></tr>
            <tr><td class="title">Carry on Back</td><td class="field">@CARRY_ON_BACK</td></tr>
            <tr><td class="title">Shift Slightly</td><td class="field">@SHIFT_SLIGHTLY</td></tr>
        </table>
    </div>
    <div class="encumbrance">
        <table class="alternate">
        <tr><th colspan="2" class="table-title">Encumbrance</th></tr>
        <tr><th>Level</th><th>Max Load</th></tr>
@ENCUMBRANCE_LOOP_START
        <tr class="@CURRENT_MARKER"><td>@LEVEL</td><td class="field">@MAX_LOAD</td></tr>
@ENCUMBRANCE_LOOP_END
        </table>
    </div>
    <div class="defense">
        <table>
            <tr><th class="table-title" colspan="2">Defense</th></tr>
        <tr><td class="title">DR</td><td class="box field">@GENERAL_DR</td></tr>
        <tr><td class="title">Move</td><td class="box field">@CURRENT_MOVE</td></tr>
        <tr><td class="title">Dodge</td><td class="box field">@CURRENT_DODGE</td></tr>
        <tr><td class="title">Block</td><td class="box field">@BEST_CURRENT_BLOCK</td></tr>
        <tr><td class="title">Parry</td><td class="box field">@BEST_CURRENT_PARRY</td></tr>
        </table>
    </div>
    <div class="hit-locations">
        <table class="alternate">
            <tr><th class="table-title" colspan="2">Hit Locations</th></tr>
            <tr><th>Location</th><th>DR</th></tr>
        @HIT_LOCATION_LOOP_START
        <tr><td>@WHERE</td><td>@DR</td></tr>
        @HIT_LOCATION_LOOP_END
        </table>
    </div>

        <div class="melee"> 
            <table class="alternate">
            <tr><th class="table-title" colspan="6">Mel√©e Attacks</th></tr>
        <tr class="heading"><th>Attack</th><th class="number">Skill</th><th>Damage</th><th class="number">Block</th><th class="number">Parry</th><th>Reach</th></tr>
@HIERARCHICAL_MELEE_LOOP_START
<tr class="field"><td colspan="6">@DESCRIPTION</td></tr>
    @ATTACK_MODES_LOOP_START
        <tr><td style="padding-left:29px">@USAGE</td><td class="number">@LEVEL</td><td>@DAMAGE</td><td class="number">@BLOCK</td><td class="number">@PARRY</td><td>@REACH</td></tr>
    @ATTACK_MODES_LOOP_END
@HIERARCHICAL_MELEE_LOOP_END
        </table>
        </div>
        <div class="ranged">
            <table class="alternate">
            <tr><th class="table-title" colspan="9">Ranged Attacks</th></tr>
            <tr class="heading"><th>Attack</th><th class="number">Skill</th><th>Damage</th><th class="number">Acc</th><th>Range</th><th class="number">RoF</th><th class="number">Shots</th><th>ST</th><th>Bulk</th></tr>
@HIERARCHICAL_RANGED_LOOP_START
<tr class="field"><td colspan="9">@DESCRIPTION</td></tr>
    @ATTACK_MODES_LOOP_START
        <tr class="field"><td style="padding-left: 29px">@USAGE</td><td class="number">@LEVEL</td><td>@DAMAGE</td><td class="number">@ACCURACY</td><td>@RANGE</td><td class="number">@ROF</td><td class="number">@SHOTS</td><td>@STRENGTH</td><td>@BULK</td></tr>
    @ATTACK_MODES_LOOP_END
@HIERARCHICAL_RANGED_LOOP_END
        </table>
        </div>
            <div class="skills">
            <table class="alternate">
                <tr><th class="table-title" colspan="4">Skills</th></tr>
                <tr class="heading"><th>Name</th><th class="number">Skill</th><th>Relative</th><th class="points">Points</th></tr>
@SKILLS_LOOP_START
                <tr class="field"><td  style="padding-left: calc(25px * @DEPTHx1 + 4px)" >@DESCRIPTION</td><td class="number">@SL</td><td>(@RSL)</td><td class="points">[@POINTS]</td></tr>
@SKILLS_LOOP_END
            </table>
            </div>
            <div class="traits">
                <table class="alternate">
                <tr><th class="table-title" colspan="2">Traits</th></tr>
                <tr><th>Name</th><th class="points">Points</th></tr>
                @EXCLUDE_TAGS_LANGUAGE
@ADVANTAGES_LOOP_START
                <tr class="field @TYPE"><td style="padding-left: calc(25px * @DEPTHx1 + 4px)" >@DESCRIPTION</td><td class="points">[@POINTS]</td></tr>
@ADVANTAGES_LOOP_END
            </table>
            </div>
<div class="carried-equipment">
    <table class="alternate">
    <tr><th class="table-title" colspan="4">Carried Equipment (@CARRIED_WEIGHT, @CARRIED_VALUE)</th></tr>
    <tr class="heading"><th>Equipment</th><th class="number">Qty</th><th class="number">Weight</th><th class="number">Value</th></tr>
@EQUIPMENT_LOOP_START
<tr class="field"><td style="padding-left: calc(25px * @DEPTHx1 + 4px)" >@DESCRIPTION</td><td class="qty@QTY number">@QTY</td><td class="number">@WEIGHT_SUMMARY</td><td class="number">$@COST_SUMMARY</td></tr>
@EQUIPMENT_LOOP_END
</table>
</div>
<!-- Other Equipment  -->
<div class="other-equipment">
    <table class="alternate">
    <tr><th class="table-title" colspan="4">Other Equipment (@OTHER_EQUIPMENT_VALUE)</th></tr>
    <tr class="heading"><th>Equipment</th><th class="number">Qty</th><th class="number">Weight</th><th class="number">Value</th></tr>
@OTHER_EQUIPMENT_LOOP_START
<tr class="field"><td style="padding-left: calc(25px * @DEPTHx1 + 4px)" >@DESCRIPTION</td><td class="qty@QTY number">@QTY</td><td class="number">@WEIGHT_SUMMARY</td><td class="number">$@COST_SUMMARY</td></tr>
@OTHER_EQUIPMENT_LOOP_END
</table>
</div>
            <div class="languages">
                <table>
                <tr><th class="table-title">Languages</th></tr>
            @LANGUAGES_LOOP_START
                <tr class="field"><td>@DESCRIPTION</td></tr>
            @LANGUAGES_LOOP_END
            </table>
            </div>
            <div class="conditional">
                <table>
                <tr><th class="table-title" colspan="2">Conditional Modifiers</th></tr>
            @CONDITIONAL_MODIFIERS_LOOP_START
            <tr class="field"><td>@MODIFIER</td><td>@SITUATION</td></tr>
            @CONDITIONAL_MODIFIERS_LOOP_END
            </table>
            </div>
            <div class="reactions">
                <table>
                <tr><th class="table-title" colspan="2">Reaction Modifiers</th></tr>
            @REACTION_LOOP_START
            <tr class="field"><td>@MODIFIER</td><td>@SITUATION</td></tr>
            @REACTION_LOOP_END
            </table>
            </div>
            <div class="notes">
                <table>
                <tr><th class="table-title">Notes</th></tr>
            @NOTES_LOOP_START
            <tr class="field"><td>@NOTE</td></tr>
            @NOTES_LOOP_END
            </table>
            </div>
            <script>
                const list = document.getElementsByClassName("qty1");
                for (var item of list) { item.innerHTML = ""; }
            </script>
            <script>
                document.getElementById("cur_hp").min = -10 * hp;
                document.getElementById("cur_fp").min = -1 * fp;
                if(mana_reserve == 0){
                    document.getElementById("mana_reserve").style.display = "none";
                }

            </script>

</body>
</html>
